<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>üé¨ Veo 3 Video Generator</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 700px; margin: auto; padding: 20px; }
    label { display: block; margin-top: 12px; font-weight: bold; }
    input, textarea, select, button { width: 100%; padding: 8px; margin-top: 6px; border-radius: 6px; border: 1px solid #ccc; }
    button { background: #4CAF50; color: white; cursor: pointer; font-size: 16px; }
    button:hover { background: #45a049; }
    .status { margin-top: 15px; font-weight: bold; }
    video { width: 100%; margin-top: 15px; border-radius: 8px; }
  </style>
</head>
<body>
  <h2>üé¨ Veo 3 Video Generator</h2>

  <label>Masukkan API Key Gemini:</label>
  <input type="text" id="apiKey" placeholder="AIza..." />

  <label>Pilih Model:</label>
  <select id="model"></select>

  <label>Prompt:</label>
  <textarea id="prompt" rows="4" placeholder="Deskripsi video..."></textarea>

  <label>Durasi (detik):</label>
  <input type="number" id="duration" value="8" />

  <label>Aspect Ratio:</label>
  <select id="ratio">
    <option value="16:9">16:9</option>
    <option value="9:16">9:16</option>
    <option value="1:1">1:1</option>
  </select>

  <label>Resolusi:</label>
  <select id="resolution">
    <option value="720p">720p</option>
    <option value="1080p" selected>1080p</option>
    <option value="4k">4K</option>
  </select>

  <button onclick="generateVideo()">üöÄ Generate Video</button>

  <div id="status" class="status"></div>
  <video id="video" controls></video>

  <script>
  // Daftar model ‚Üí tinggal tambahin di sini kalau ada versi baru
  const veoModels = [
    "veo-3.0-generate-preview",
    "veo-3.0-text-to-video",
    "veo-3.0-video-edit-preview"
  ];

  // Isi dropdown model otomatis
  const modelSelect = document.getElementById("model");
  veoModels.forEach(m => {
    let opt = document.createElement("option");
    opt.value = m;
    opt.textContent = m;
    modelSelect.appendChild(opt);
  });
  modelSelect.value = veoModels[0]; // default model pertama

  async function generateVideo() {
    const apiKey = document.getElementById('apiKey').value.trim();
    const model = document.getElementById('model').value;
    if (!apiKey) return alert('Masukkan API Key Gemini dulu!');

    const prompt = document.getElementById('prompt').value;
    const duration = parseInt(document.getElementById('duration').value);
    const aspectRatio = document.getElementById('ratio').value;
    const resolution = document.getElementById('resolution').value;

    const statusEl = document.getElementById('status');
    const videoEl = document.getElementById('video');

    statusEl.textContent = '‚è≥ Mengirim request...';

    try {
      let res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${model}:predict?key=${apiKey}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          instances: [{ prompt }],
          parameters: {
            aspectRatio,
            durationSeconds: duration,
            resolution,
            generateAudio: false
          }
        })
      });

      let data = await res.json();
      console.log('Submit response:', data);

      if (!data.name) {
        statusEl.textContent = '‚ùå Gagal: ' + JSON.stringify(data);
        return;
      }

      const operationId = data.name;
      statusEl.textContent = '‚è≥ Video sedang diproses...';

      let videoUrl = null;
      while (true) {
        let poll = await fetch(`https://generativelanguage.googleapis.com/v1beta/operations/${operationId}?key=${apiKey}`);
        let pollData = await poll.json();
        console.log('Polling:', pollData);

        if (pollData.done) {
          if (pollData.response && pollData.response.videos && pollData.response.videos.length > 0) {
            videoUrl = pollData.response.videos[0].uri;
          }
          break;
        }
        await new Promise(r => setTimeout(r, 5000));
      }

      if (videoUrl) {
        statusEl.textContent = '‚úÖ Video siap!';
        videoEl.src = videoUrl;

        // Tambahin tombol download (hapus yang lama kalau ada)
        let oldBtn = document.getElementById("dlBtn");
        if (oldBtn) oldBtn.remove();

        let dlBtn = document.createElement("a");
        dlBtn.id = "dlBtn";
        dlBtn.href = videoUrl;
        dlBtn.textContent = "‚¨áÔ∏è Download Video";
        dlBtn.download = "veo3_video.mp4";
        dlBtn.style.display = "block";
        dlBtn.style.marginTop = "10px";
        document.body.appendChild(dlBtn);
      } else {
        statusEl.textContent = '‚ùå Video gagal dihasilkan.';
      }

    } catch (err) {
      console.error(err);
      statusEl.textContent = '‚ö†Ô∏è Error: ' + err.message;
    }
  }
  </script>
</body>
</html>